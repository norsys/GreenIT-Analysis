
# GreenIT-Analysis CLI

This CLI aims to launch a Chrome Browser with the GreenIT-Analysis plugin, and run analysis regarding a scenario, in order to be launch manually or integrated with CI process.

## Platform Requirements

* Npm (V6)
* Chrome (V85)

## Setup

Simply clone the repo, and install it globally using npm

```
git clone https://github.com/cnumr/GreenIT-Analysis.git
cd cli
npm build -g .
```

## Usage

Register your analysis into a scenario json file as described below, then run

`greenit-analysis  --scenario /path/to/scenario.json --chromePath /path/to/executable/chrome`

> Example for Mac User : `greenit-analysis  --scenario /tmp/example/scenario.json --chromePath "/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"`
> Example for windows user : `greenit-analysis --scenario C:\tmp\example\scenario.json --chromePath "C:\Program Files (x86)\Google\Chrome\Application\chrome.exe"`

### Scenario

Here is an example of a `scenarion.json`

```
{
  "endpoints": [
    {
      "name": "Login",
      "url": "https://the-internet.herokuapp.com/login",
      "hasToBeLoggedIn": false
    },
    {
      "name": "Secure",
      "url": "https://the-internet.herokuapp.com/secure",
      "hasToBeLoggedIn": true
    },
    {
      "name": "Menu",
      "url": "https://the-internet.herokuapp.com/jqueryui/menu",
      "hasToBeLoggedIn": false
    }
  ],
  "loginUrl": "https://the-internet.herokuapp.com/login",
  "userDivSelector": "#username",
  "passwordDivSelector": "#password",
  "loginBtnSelector": "#login > button",
  "user": "tomsmith",
  "password": "SuperSecretPassword!",
  "resultPath" : "./test/"
}
```

* `endpoints` is the list of the unique endpoints you want to analyse  
    * `name`: the readable name of the endpoint used for directoy report path 
    * `url`: the HTTP URL of thue endpoint 
    * `hasToBeLoggedIn`: set to `true` if login form need to be sumitted before analysing the endpoint
* `resultPath`: the directory where to write the reports (absolute or relative, needs to hav write permission)
* `loginUrl`: the URL of the login form to submit if `hasToBeLoggedIn`is set to true
* `userDivSelector` : the CSS selector for the username input
* `passwordDivSelector`: the CSS selector for the password input
* `loginBtnSelector`: the CSS selector to click on the form submit buton
* `user`: the user to use to login
* `password`: the user's password to log in

## Reports

After execution, 3 reports will be generated by endpoints in le folder "`<resultPath>`/`<endpoint name>`/"

* `ecoIndex.html` : the HTML report extracted from the actual plugin
* `ecoIndex.json`: the json export of the result and its detail
* `ecoIndex.svg`: an ecoIndex badge to be integrated in you web site

### Badge usage

If the generated reports are integrated in the static directory of a website, badges can be integrated using this snippet :

```
<!-- add link to Green IT reports -->
<a href="/<path to Static report>/ecoIndex.html">
    <img src="/<path to Static report>/ecoIndex.svg" >
</a>
```

## Contributing

### Install dependencies

In the `cli` directory : `npm install`

### Debug

In the `cli` directory : `npm link`  
Then use the same command line inside the VSCode Debug Terminal for example.

### Choices

#### Why not to use Chromium

Chromium has a "bug" that is counting twice each HTTP request (https://bugs.chromium.org/p/chromium/issues/detail?id=64810), this is why we need to pass the Chrome executable path in command line parameter.

### Next ?

* Add prompt to build the scenario.json dynamically
* Personnalize reports 



